<div class="notification-card" [class.unread]="!notification.seen" (click)="onClick()">
  <div class="notification-content">
    <!-- Avatar Section -->
    <div class="avatar-section">
      @if (notification.sender) {
        <a [routerLink]="['/profile', notification.sender.username]" class="avatar-link" (click)="$event.stopPropagation()">
          @if (notification.sender.profile) {
            <img [src]="missing.avatar_link(notification.sender.profile)" 
                 [alt]="notification.sender.username" 
                 class="avatar"
                 [ngClass]="missing.getImageClass(notification.sender)">
          } @else {
            <div class="avatar no-avatar" [ngClass]="missing.getBackgroundColor(notification.sender.username)">
              <span class="initials">{{ missing.getInitial(notification.sender.username) }}</span>
            </div>
          }
        </a>
      } @else {
        <div class="avatar system-avatar">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="robot-icon">
            <rect x="4" y="8" width="16" height="12" rx="2" stroke-width="2"/>
            <circle cx="8.5" cy="12" r="1" fill="currentColor"/>
            <circle cx="15.5" cy="12" r="1" fill="currentColor"/>
            <path d="M9 16h6" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 8V4M10 4h4" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
      }
    </div>

    <!-- Content Section -->
    <div class="content-section">
      <div class="header-line">
        @if (notification.sender) {
          <a [routerLink]="['/profile', notification.sender.username]" 
             class="sender-name" 
             (click)="$event.stopPropagation()">
            {{ notification.sender.name || notification.sender.username }}
          </a>
          <span class="action-text">{{ getActionText() }}</span>
        } @else {
          <span class="sender-name system">System Update</span>
          @if (notification.type === 'REMOVED' || notification.type === 'HIDDEN') {
            <span class="important-badge">Important</span>
          }
        }
        <span class="timestamp">{{ getRelativeTime() }}</span>
      </div>

      <p class="message">{{ getMessagePreview() }}</p>

      @if (notification.link) {
        <a [routerLink]="notification.link" 
           class="view-link" 
           (click)="$event.stopPropagation()">
          View Post â†’
        </a>
      }
    </div>

    <!-- Action Button -->
    <button class="mark-btn" 
            [class.read]="notification.seen"
            [class.unread]="!notification.seen"
            (click)="toggleReadStatus($event)">
      {{ notification.seen ? 'Mark as Unread' : 'Mark as Read' }}
    </button>

    <!-- Delete Button (Mobile only in flow) -->
    <button class="delete-btn" (click)="onDelete($event)" title="Delete notification">
      <span class="material-icons">close</span>
    </button>
  </div>

  <!-- Delete Button (Desktop - absolute positioned) -->
  <button class="delete-btn desktop-delete" (click)="onDelete($event)" title="Delete notification">
    <span class="material-icons">close</span>
  </button>
</div>